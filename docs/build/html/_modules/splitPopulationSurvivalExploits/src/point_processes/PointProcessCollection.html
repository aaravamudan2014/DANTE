
<!DOCTYPE html>

<html lang="Python">
  <head>
    <meta charset="utf-8" />
    <title>splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection &#8212; SPIE 0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="sd">&#39;&#39;&#39;PointProcessCollection.py</span>
<span class="sd">    Temporal Point Process (TPP) sub-classes</span>
<span class="sd">        Author: Georgios C. Anagnostopoulos, April 2019</span>
<span class="sd">     Edited by: Akshay Aravamudan (added some documentation and fixed imports)</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="c1">##########################################################################################</span>
<span class="c1"># PointProcessCollection.py</span>
<span class="c1">#   This file contains all the sub-classes for the Temporal Point Process (tpp) base class.</span>
<span class="c1">#   Currently the following point processes have been implemented:</span>
<span class="c1">#       - Inhomogenous Poisson Process</span>
<span class="c1">#</span>
<span class="c1">##########################################################################################</span>


<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">from</span> <span class="nn">point_processes.TemporalPointProcess</span> <span class="kn">import</span> <span class="n">TemporalPointProcess</span> <span class="k">as</span> <span class="n">TPP</span><span class="p">,</span> <span class="n">TrainingStatus</span>
<span class="kn">from</span> <span class="nn">utils.MemoryKernel</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="PoissonTPP"><a class="viewcode-back" href="../../../../index.html#splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection.PoissonTPP">[docs]</a><span class="k">class</span> <span class="nc">PoissonTPP</span><span class="p">(</span><span class="n">TPP</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Poisson Temporal Point Process&#39;&#39;&#39;</span>

    <span class="c1"># Instance variables</span>
    <span class="c1">#</span>
    <span class="c1">#   sourceNames:           list of strings; names of the TPP&#39;s sources; inherited from TPP base class.</span>
    <span class="c1">#   desc:                  string; short textual description of the TPP; inherited from TPP base class.</span>
    <span class="c1">#   _logger:               logger object; for logging; inherited from TPP base class.</span>
    <span class="c1">#   _setupTrainingDone:    boolean; informs whether the setupTraining(); inherited from TPP base class.</span>
    <span class="c1">#   alpha                  float; TPP parameter.</span>
    <span class="c1">#   mk                     object of a MemoryKernel subclass; TPP parameter.</span>
    <span class="c1">#   __totalTrainingEvents: non-negative integer; a quantity required during training.</span>
    <span class="c1">#   __sumOfPsis:           non-negative real scalar; a quantity required during training.</span>

    <span class="c1"># mk:          a specific MemoryKernel object with fixed parameters.</span>
    <span class="c1"># sourceNames: list of strings with the source names. The list&#39;s first element is the name of the TPP&#39;s own source.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mk</span><span class="p">,</span> <span class="n">sourceNames</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Poisson TPP&#39;</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mk</span> <span class="o">=</span> <span class="n">mk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initParams</span><span class="p">()</span>  <span class="c1"># initialize alpha</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sourceNames</span><span class="p">,</span> <span class="n">desc</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>

    <span class="c1"># t: float or 1-dimensional numpy.ndarray of reals; relative event time(s). Typically, larger than 0.</span>
    <span class="c1"># TPPdata: a list containing the process&#39; own (possibly, empty) realization.</span>
<div class="viewcode-block" id="PoissonTPP.intensity"><a class="viewcode-back" href="../../../../index.html#splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection.PoissonTPP.intensity">[docs]</a>    <span class="k">def</span> <span class="nf">intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">TPPdata</span><span class="p">):</span>
        <span class="c1"># TPPdata is actually unused for this process</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">phi</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="c1"># t: float or 1-dimensional numpy.ndarray of reals; relative event time(s). Typically, larger than 0.</span>
    <span class="c1"># TPPdata: a list containing the process&#39; own (possibly, empty) realization.</span>
<div class="viewcode-block" id="PoissonTPP.cumIntensity"><a class="viewcode-back" href="../../../../index.html#splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection.PoissonTPP.cumIntensity">[docs]</a>    <span class="k">def</span> <span class="nf">cumIntensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">TPPdata</span><span class="p">):</span>
        <span class="n">Realization</span> <span class="o">=</span> <span class="n">TPPdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tN</span> <span class="o">=</span> <span class="n">Realization</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Realization</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">tN</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span></div>

    <span class="c1"># Simulate the TPP via the inverse time transformation approach</span>
    <span class="c1"># Returns a realization, which includes the relative right-censoring time (rightCensoringTime; see below)</span>
    <span class="c1"># as its last event time.</span>
    <span class="c1"># rightCensoringTime: strictly positive float; represents the relative censoring time to be used.</span>
    <span class="c1"># TPPdata: List of S (possibly, empty) realizations.</span>
    <span class="c1"># resume:  boolean; if True, assumes that the TPP&#39;s own realization includes a relative</span>
    <span class="c1">#          right-censoring time and removes it in order to resume the simulation from the last recorded</span>
    <span class="c1">#          event time.</span>
<div class="viewcode-block" id="PoissonTPP.simulate"><a class="viewcode-back" href="../../../../index.html#splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection.PoissonTPP.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rightCensoringTime</span><span class="p">,</span> <span class="n">TPPdata</span><span class="p">,</span> <span class="n">resume</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">RealizationList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">TPPdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">SimulatedRealization</span> <span class="o">=</span> <span class="n">RealizationList</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span>
            <span class="n">resume</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">RealizationList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">RealizationList</span>
        <span class="c1"># time of last event of the realization</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">SimulatedRealization</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SimulatedRealization</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">stdExponentialDistribution</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">expon</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">stdExponentialDistribution</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>  <span class="c1"># draw an Exp(1) sample</span>
            <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">psiInv</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">rightCensoringTime</span><span class="p">:</span>
                <span class="n">SimulatedRealization</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rightCensoringTime</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">SimulatedRealization</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">SimulatedRealization</span><span class="p">)</span></div>

    <span class="c1"># Setup TPP model for training.</span>
    <span class="c1"># Typically used for pre-computing quantities that are necessary for training.</span>
    <span class="c1"># This method is expected to be called prior to a call to the train() method.</span>
    <span class="c1"># TPPdata: List of S lists, where each inner list contains R realizations.</span>
    <span class="c1">#          Each realization contains at least a relative right-censoring time as its last event time.</span>
<div class="viewcode-block" id="PoissonTPP.setupTraining"><a class="viewcode-back" href="../../../../index.html#splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection.PoissonTPP.setupTraining">[docs]</a>    <span class="k">def</span> <span class="nf">setupTraining</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TPPdata</span><span class="p">):</span>
        <span class="n">Realizations</span> <span class="o">=</span> <span class="n">TPPdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__totalTrainingEvents</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sumOfPsis</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">Realization</span> <span class="ow">in</span> <span class="n">Realizations</span><span class="p">:</span>
            <span class="c1"># excludes relative right-censoring time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__totalTrainingEvents</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Realization</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">Realization</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># process&#39; relative right-censoring time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__sumOfPsis</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setupTrainingDone</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># indicate that setupTraining() has been ran already</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PoissonTPP.setupTraining() finished.&#39;</span><span class="p">)</span></div>

    <span class="c1"># Train the TPP model.</span>
    <span class="c1"># Returns an element of the TrainingStatus enumeration.</span>
<div class="viewcode-block" id="PoissonTPP.train"><a class="viewcode-back" href="../../../../index.html#splitPopulationSurvivalExploits.src.point_processes.PointProcessCollection.PoissonTPP.train">[docs]</a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setupTrainingDone</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;PoissonTPP: train() method is called before a call to the setupTraining() method!&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sumOfPsis</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__totalTrainingEvents</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sumOfPsis</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;PoissonTPP.train(): infinite alpha value!&#39;</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">TrainingStatus</span><span class="o">.</span><span class="n">CONVERGED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;PoissonTPP.train(): training converged.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span></div>

    <span class="c1"># Is used by an Ogata&#39;s thinning algorithm to simulate the process.</span>
    <span class="k">def</span> <span class="nf">intensityUB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">rightCensoringTime</span><span class="p">,</span> <span class="n">TPPdata</span><span class="p">):</span>
        <span class="n">Realization</span> <span class="o">=</span> <span class="n">TPPdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># time of last event of the realization</span>
        <span class="n">t_final</span> <span class="o">=</span> <span class="n">Realization</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Realization</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">assert</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">t_final</span><span class="p">,</span> <span class="s2">&quot;Upper bound time value must be greater than latest event in the history&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span><span class="o">.</span><span class="n">phiUB</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">rightCensoringTime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># Returns the TTP&#39;s model parameters as a tuple.</span>
    <span class="k">def</span> <span class="nf">getParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mk</span>

    <span class="c1"># Sets a TPP&#39;s parameters.</span>
    <span class="c1"># params: a tuple of parameters</span>
    <span class="k">def</span> <span class="nf">setParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mk</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Initializes a TPP&#39;s parameters</span>
    <span class="k">def</span> <span class="nf">initParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># assing a dummy positive value</span></div>


<span class="c1">################################################################################</span>
<span class="c1">#</span>
<span class="c1"># U N I T   T E S T I N G</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>


<span class="c1"># Some global settings for figure sizes</span>
<span class="n">normalFigSize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># (width,height) in inches</span>
<span class="n">largeFigSize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">xlargeFigSize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

<span class="c1"># Unit-test PoissonTPP class</span>


<span class="k">def</span> <span class="nf">unitTest_PoissonTPP</span><span class="p">():</span>
    <span class="c1"># Define the ground-truth TPP as a (inhomogenous) Poisson TPP with a GammaGompertz(1.0, 2.0) memory kernel.</span>
    <span class="n">mk</span> <span class="o">=</span> <span class="n">GammaGompertzMemoryKernel</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">sourceNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ownEvents&#39;</span><span class="p">]</span>  <span class="c1"># this TPP only uses its own events as source.</span>
    <span class="n">truetpp</span> <span class="o">=</span> <span class="n">PoissonTPP</span><span class="p">(</span>
        <span class="n">mk</span><span class="p">,</span> <span class="n">sourceNames</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Poisson TPP with a GammaGompertz(1.0, 2.0) kernel&#39;</span><span class="p">)</span>
    <span class="n">truetpp</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># set parameter for the TPP&#39;s conditional intensity.</span>

    <span class="c1"># Print out informormation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The procces&#39; description: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">truetpp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The procces&#39; source names: &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">truetpp</span><span class="o">.</span><span class="n">sourceNames</span><span class="p">)</span>

    <span class="c1"># Generate some realizations with random start times &amp; right-censoring times</span>
    <span class="n">numRealizations</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">Realizations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">maxNumEvents</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">maxNumEventsIdx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">numRealizations</span><span class="p">):</span>
        <span class="c1"># Exponential(100)-distributed right-censoring time</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">expon</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="n">Realization</span> <span class="o">=</span> <span class="n">truetpp</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])])</span>
        <span class="n">Realizations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Realization</span><span class="p">)</span>
        <span class="n">numEvents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Realization</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numEvents</span> <span class="o">&gt;</span> <span class="n">maxNumEvents</span><span class="p">:</span>
            <span class="n">maxNumEvents</span> <span class="o">=</span> <span class="n">numEvents</span>
            <span class="n">maxNumEventsIdx</span> <span class="o">=</span> <span class="n">r</span>

    <span class="c1"># Define the model TPP as a (inhomogenous) Poisson TPP with a GammaGompertz(1.0, 2.0) memory kernel.</span>
    <span class="n">mk</span> <span class="o">=</span> <span class="n">GammaGompertzMemoryKernel</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">sourceNames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ownEvents&#39;</span><span class="p">]</span>  <span class="c1"># this TPP only uses its own events as source.</span>
    <span class="n">modeltpp</span> <span class="o">=</span> <span class="n">PoissonTPP</span><span class="p">(</span>
        <span class="n">mk</span><span class="p">,</span> <span class="n">sourceNames</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Poisson TPP with a GammaGompertz(1.0, 2.0) kernel&#39;</span><span class="p">)</span>

    <span class="c1"># Train the model</span>
    <span class="c1"># pre-calculates quantities needed for training</span>
    <span class="n">modeltpp</span><span class="o">.</span><span class="n">setupTraining</span><span class="p">([</span><span class="n">Realizations</span><span class="p">])</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">modeltpp</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training resulted in a status of </span><span class="si">{:1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>

    <span class="c1"># Assess trained model&#39;s quality</span>
    <span class="c1"># only meaningful if both TPPs use the same kernel and the same kernel parameter values.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated a=</span><span class="si">{:1}</span><span class="s1"> vs. true a=</span><span class="si">{:2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">modeltpp</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="n">truetpp</span><span class="o">.</span><span class="n">alpha</span><span class="p">))</span>
    <span class="c1"># pick, for example, the longest realization that was used for training.</span>
    <span class="n">Realization</span> <span class="o">=</span> <span class="n">Realizations</span><span class="p">[</span><span class="n">maxNumEventsIdx</span><span class="p">]</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">normalFigSize</span><span class="p">)</span>
    <span class="c1"># generate the P-P plot</span>
    <span class="n">pvalue</span> <span class="o">=</span> <span class="n">modeltpp</span><span class="o">.</span><span class="n">GOFks</span><span class="p">([</span><span class="n">Realization</span><span class="p">],</span> <span class="n">ax</span><span class="p">,</span> <span class="n">showConfidenceBands</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;KS test p-value=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pvalue</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Unit testing of implemented TPPs</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">unitTest_PoissonTPP</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/SPIELogo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../git_workflow.html">Git Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../install_repo.html">Package installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage_examples.html">Why use SPIE ?</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Akshay Aravamudan, Georgios Anagnostopoulos, Xi Zhang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>